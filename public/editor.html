<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="./style.css">
        <title>396 Project</title>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>
        <script type="text/javascript">
        (function() {
        emailjs.init("user_1IZakKa6zWJPJnqECuxm4");
        })();
        </script>
        <script type="text/javascript">
            window.onload = function() {
                document.getElementById('contact-form').addEventListener('submit', function(event) {
                    event.preventDefault();
                    // generate a five digit number for the contact_number variable
                    this.contact_number.value = Math.random() * 100000 | 0;
                    // these IDs from the previous steps
                    emailjs.sendForm('service_th6h2vj', 'template_pjlpmnu', this)
                        .then(function() {
                            console.log('SUCCESS!');
                        }, function(error) {
                            console.log('FAILED...', error);
                        });
                });
            }
        </script>
    </head>
    <body>
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script src="editor.js" type="text/javascript"></script>
    
        <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>

    <!-- Create a div where the graph will take place -->
    <div id="my_dataviz" class="container"></div>


    <script>

    // set the dimensions and margins of the graph
    var margin = {top: 10, right: 30, bottom: 30, left: 60},
        width = 460 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;

    // append the svg object to the body of the page
    var svg = d3.select("#my_dataviz")
    .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
    .append("g")
        .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

    //Read the data
    d3.csv("./test.csv", function(data) {

        // Add X axis
        var x = d3.scaleLog()
            .domain([1000000, 10000000000000])
            .range([ 0, width ])
            .base(10000);

        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x));

        // Add Y axis
        var y = d3.scaleLog()
            .domain([1000, 100000000000000])
            .range([ height, 0])
            .base(10000);

        svg.append("g")
            .call(d3.axisLeft(y));

        // Add a tooltip div. Here I define the general feature of the tooltip: stuff that do not depend on the data point.
        // Its opacity is set to 0: we don't see it by default.
        const tooltip = d3.select("#my_dataviz")
            .append("div")
            .style("opacity", 0)
            .attr("class", "tooltip")
            .style("background-color","black")
            .style("border", "solid")
            .style("border-width", "1px")
            .style("border-radius", "5px")
            .style("padding", "10px")

          // A function that change this tooltip when the user hover a point.
        // Its opacity is set to 1: we can now see it. Plus it set the text and position of tooltip depending on the datapoint (d)
        const mouseover = function(event, d) {
            tooltip
            .style("opacity", 1)
        }

        const mousemove = function(event, d) {
            tooltip
            .html(`The exact value of<br>the market cap is: ${d.market_cap}`)
            .style("top", d3.select(this).attr("cy") + "px")
            .style("left", d3.select(this).attr("cx") + "px")
        }

        // A function that change this tooltip when the leaves a point: just need to set opacity to 0 again
        const mouseleave = function(event,d) {
            tooltip
            .transition()
            .duration(1000)
            .style("opacity", 0)
        }

        // Add dots
        svg.append('g')
            .selectAll("dot")
            .data(data)
            .enter()
            .append("circle")
                .attr("cx", function (d) { return x(d.market_cap); } )
                .attr("cy", function (d) { return y(d.circulating_supply); } )
                .attr("r", 7)
                .style("fill", "#69b3a2")
                .style("opacity", 0.3)
                .style("stroke","green")
            .on("mouseover", mouseover )
            .on("mousemove", mousemove )
            .on("mouseleave", mouseleave )

        })

    </script>
               <div id = "contractForm"></div>
               <div id ="info"></div>
    
           </div>
           <div id = "main">
            <p id= "crypto"></p>
            <div id ="mid"></div>
            <div id ="right">
             <div id="coins">
                 <button onclick="contractDeploy('bitcoin')">Bitcoin</button>
                 <button onclick="contractDeploy('ethereum')">Ethereum</button>
                 <button onclick="contractDeploy('binancecoin')">Binance Coin</button>
                 <button onclick="contractDeploy('solana')">Solana</button>
                 <button onclick="contractDeploy('cardano')">Cardano</button>
                 <button onclick="contractDeploy('ripple')">XRP</button>
                 <button onclick="contractDeploy('polkadot')">Polkadot</button>
                 <button onclick="contractDeploy('dogecoin')">Dogecoin</button>
 
            </div>
            </div>
    </body>
</html>